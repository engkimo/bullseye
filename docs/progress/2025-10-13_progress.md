# 進捗サマリー（2025-10-13）

## 概要
- 評価基盤を整備し、bullseye（yomitoku相当）固定でテーブル評価の全量実行を完了。
- 生成物（ログ/メトリクス/TeX）と再現手順を標準化し、トレーサビリティを確保。

## 主な変更（実装）
- bullseye強制とラベル正規化
  - ローカル重み強制: `models/bullseye/*` を優先使用（det/rec/layout/table）。
  - ラベル統一: recognizer → `bullseye-parseq:Ryousukee/bullseye-recparseq`、detector/layout/table も固定表記。
- 評価スクリプト強化（`scripts/collect_metrics.py`）
  - bullseye強制（ENV注入）/ `--limit` / 実行メタ `run.json` / 進捗イベント `events.jsonl` / per-file `cli_stdout.log` `cli_stderr.log`。
  - TEDSフォールバック（teds未導入でも行列一致度で近似）+ 予測HTMLが空の際のスケルトン格子推定。
- ユーティリティ追加
  - `scripts/make_table_subset.sh`（サブセット作成）
  - `scripts/report_teds_coverage.py`（GTカバレッジ）
  - `scripts/make_teds_gt_from_existing_results.py` / `scripts/make_teds_gt_from_table_preds.py` / `scripts/make_teds_gt_fullimage.py`
  - `scripts/gen_skeleton_table_gt.py`（線検出でGT HTML生成）
- ドキュメント
  - 貢献者向け: `AGENTS.md` を刷新（構造/コマンド/スタイル/テスト/PR/セキュリティ）。

## 実行結果（主要数値）
- テーブル画像 2000枚（`data/table/images`）
  - latency（bullseye固定, LLM無効, TEDS計測ON）: p50 ≈ 7.40s/枚, p95 ≈ 7.70s/枚。
  - GTカバレッジ: 100%（`<stem>.gt.html` 自動生成）。
  - 出力: `results/metrics_tables_full_bullseye/`（`metrics.csv`/`summary.json`/`events.jsonl`）。
  - TeX: `docs/paper/tables/{tables.tex, layout.tex, docqa.tex}`、TBFはログ化。

## 次アクション
1) TEDSの確定
- 近似TEDSで全量を再集計（または `pip install -r requirements-extras.txt` で正式TEDS導入）。
  - `python scripts/collect_metrics.py --data-root data/table/images \
    --out results/metrics_tables_full_bullseye --cli bullseye --format json \
    --with-llm false --teds true --force-bullseye true`
  - その後: `python scripts/gen_tex_tables.py --metrics results/metrics_tables_full_bullseye/metrics.csv \
    --out-root docs/paper/tables --tbf-log docs/paper/tables/tbf.log \
    --tbf-log-jsonl results/metrics_tables_full_bullseye/tbf_log.jsonl`

2) レイアウト mAP の測定
- DocLayNetの実パスで `configs/eval_layout_doclaynet.json` を作成 → `python -m src.eval_layout --config ... --output results/layout_metrics.json`
  - 暫定は `configs/eval_layout_synth.json` で回せます。

3) QA(ANLS) の集計
- `<stem>.qa.jsonl` を用意 → `scripts/collect_metrics.py --with-llm true --eval-qa true` で収集。

4) メトリクスの固定化/公開
- `results/metrics_tables_full_bullseye/summary.json` を版管理、SLI（p50/p95/失敗率）をダッシュボード化（将来: CIへ移行）。

## 参照パス
- 生成物: `results/metrics_tables_full_bullseye/`, `docs/paper/tables/`
- スクリプト: `scripts/collect_metrics.py`, `scripts/gen_skeleton_table_gt.py`, 他ユーティリティ各種
- 設定/ドキュメント: `AGENTS.md`, `docs/requirements_definition/*`

